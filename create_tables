CREATE TABLE gpw_instrumenty (
    id_instrumentu    NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    isin              VARCHAR2(12) NOT NULL,
    nazwa             VARCHAR2(255) NOT NULL,
    waluta            CHAR(3) NOT NULL,
    Gielda            VARCHAR2(50) DEFAULT 'GPW' NOT NULL, -- Nowa kolumna
    data_dodania      DATE DEFAULT SYSDATE,
    CONSTRAINT uq_isin UNIQUE (isin)
);

CREATE TABLE gpw_notowania_dzienne (
    id_notowania      NUMBER GENERATED BY DEFAULT AS IDENTITY,
    id_instrumentu    NUMBER NOT NULL,
    data              DATE NOT NULL,
    kurs_otwarcia     NUMBER(19, 4),
    kurs_max          NUMBER(19, 4),
    kurs_min          NUMBER(19, 4),
    kurs_zamkniecia   NUMBER(19, 4),
    zmiana            NUMBER(10, 4),
    wolumen           NUMBER(20, 0),
    liczba_transakcji NUMBER(15, 0),
    obrot             NUMBER(19, 2),
    
    CONSTRAINT pk_notowania PRIMARY KEY (id_instrumentu, data),
    CONSTRAINT fk_instr_notowania FOREIGN KEY (id_instrumentu) 
        REFERENCES gpw_instrumenty(id_instrumentu)
)
PARTITION BY RANGE (data) INTERVAL (NUMTOYMINTERVAL(1, 'MONTH')) (
    PARTITION p_start VALUES LESS THAN (TO_DATE('2024-01-01', 'YYYY-MM-DD'))
);

-- Indeks przyspieszajÄ…cy filtrowanie po dacie
CREATE INDEX idx_notowania_data ON gpw_notowania_dzienne(data);


CREATE TABLE gpw_log_importu (
    id_logu           NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    data_notowan      DATE UNIQUE, -- Data pliku z GPW
    data_importu      TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    liczba_wierszy    NUMBER,
    status            VARCHAR2(20) -- Np. 'SUKCES', 'BLAD'
);
